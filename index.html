<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Steinhagelvoll Blog &middot; Scientific programming Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Here I discuss scientific programming and all things related: Fortran, Julia, Python, MPI and sometimes just elegant programming</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    

    <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Steinhagelvoll Blog</a>
            <small>Scientific programming Blog</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2016/09/27/julia-parallelism-benchmark/">
        Julia parallelism benchmarking
      </a>
    </h1>

    <span class="post-date">27 Sep 2016</span>

    <h1 id="motivation">Motivation</h1>

<p>Yesterday I realized, that Julia ist fast, but not as fast at Fortran. Which I though is ok as long as I can compensate by scalling to a lot of hardware. So today I tried this. I compared Julias parallel for loops to OpenMP. I think if Julia wants to best the Python with C-speed than it has to keep up with OpenMP, which seems to be the gold standart for shared memory parallelism.</p>

<h1 id="setup">Setup</h1>

<p>I decided to build on yesterdays code and parallelize the loop that test all the numbers if they are prime. This is a quite tricky loop for parallelization, because it takes longer to test a big prime number than a small one and because primes are randomly distributed. If the parallelization is done by just cutting the range into equal parts:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>P1: 1,2,3
P2: 4,5,6
P3: 7,8,9
....
</code></pre>
</div>
<p>The first chunk will be processed a long time before the last one is done. If on the otherhand we choose an interleaving distribution:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>P1: 1,5,9...
P2: 2,6,10...
P3: 3,7,11...
P4: 4,8,12..
</code></pre>
</div>
<p>we would also get a bad speedup, because process 1 always get smaller numbers than process 4. This is why we need a dynamic distribution, which hands out the work at processes free up. I compared three thing:</p>
<ul>
  <li>Fortran with dynamic scheduling</li>
  <li>Fortran with static  scheduling</li>
  <li>Julia parallelism</li>
</ul>

<p>I will attach the code at the end.
https://steinhagelvoll.github.io/
<img src="https://steinhagelvoll.github.io//_images/julia_speedup.png" alt="alt text" title="Logo Title Text 1" /></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2016/09/26/julia-benchmark/">
        Julia benchmarking
      </a>
    </h1>

    <span class="post-date">26 Sep 2016</span>

    <p><a href="# Results">tl;dr -&gt; results</a>
I don’t know why the link doesn’t work just scroll to the bottom.</p>
<h1 id="motivation">Motivation</h1>
<p>Since I’m not forced to use any particular programming language next semester I decided to have a look around and one language that always seems intriging is Julia. Julia claims to be as easy as Python &amp; Numpy and as fast as Fortran and C. Sadly as of now the first isn’t true. This is simply because of the lack of material on Julia. The documentation is mainly a number of definitons and doesn’t convey the philosophy of the language, but this is something that I believe to be quite important. 
As an example I’d like to mention Bjarne Stroustrups “The C++ Programming Language”. While most C++ books could easily be directly translated from a Java book Stroustrup take the time to explain what make a good style and why templates are awesome.
Sadly this is something that Julia is missing sofar. The books I’ve seen sofar are presenting all the features, but the authors haven’t thought about styles.</p>

<h1 id="benchmark">Benchmark</h1>
<p>Enough talk let’s see the benchmark. I wrote a very simple routine which calculates the numbers of primes between two numbers. I did this in Fortran:</p>
<pre><code class="language-Fortran">program main
  use omp_lib
  integer*4  :: i, cnt
  real*8     :: ostart, ostop


  cnt = 0
  ostart = omp_get_wtime()

  do i = 1000000, 6000000
    if(is_prime(i)) then
      cnt = cnt + 1
    endif
  enddo
  ostop = omp_get_wtime()

  write (*,*) "time: ", ostop - ostart
  write (*,*) cnt
contains
  function is_prime(n)
    implicit none
    integer*4, intent(in)     :: n
    logical                   :: is_prime
    integer*4                 :: j
    is_prime = .false.

    if(mod(n,2) == 0) then
      is_prime = .false.
      return
    endif

    j = 3
    do while(j*j &lt;= n)
      if(mod(n,j) == 0)  then
        is_prime = .false.
        return
      endif
      j = j + 2
    enddo
    is_prime = .true.
  end function is_prime
end program main
</code></pre>

<p>I did it in python:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">while</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">%</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="bp">True</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">,</span> <span class="mi">6000000</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">is_prime</span><span class="p">(</span><span class="n">i</span><span class="p">)):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>


<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">run</span><span class="p">()</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"time: </span><span class="si">%</span><span class="s">f sec"</span><span class="o">%</span><span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">))</span>
</code></pre>
</div>
<p>and finally I did it in Julia:</p>

<div class="language-julia highlighter-rouge"><pre class="highlight"><code><span class="k">function</span><span class="nf"> is_prime</span><span class="x">(</span><span class="n">n</span><span class="x">)</span>
	<span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
		<span class="k">return</span> <span class="n">false</span>
	<span class="k">end</span>
	<span class="n">j</span> <span class="o">=</span> <span class="mi">3</span>
	<span class="k">while</span><span class="x">(</span><span class="n">j</span><span class="o">*</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="x">)</span>
		<span class="k">if</span><span class="x">(</span><span class="n">n</span><span class="o">%</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="x">)</span>
			<span class="c">#println(j)</span>
			<span class="k">return</span> <span class="n">false</span>
		<span class="k">end</span>
		<span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span>
	<span class="k">end</span>
	<span class="k">return</span> <span class="n">true</span>
<span class="k">end</span>

<span class="k">function</span><span class="nf"> main</span><span class="x">()</span>
	<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1000000</span><span class="x">:</span><span class="mi">6000000</span>
		<span class="k">if</span> <span class="n">is_prime</span><span class="x">(</span><span class="n">i</span><span class="x">)</span>
			<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">end</span>
	<span class="k">end</span>
	<span class="n">println</span><span class="x">(</span><span class="n">count</span><span class="x">)</span>
<span class="k">end</span>

<span class="nd">@time</span> <span class="n">main</span><span class="x">()</span>
</code></pre>
</div>

<h1 id="results">Results</h1>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-yw4l{vertical-align:top}
</style>

<table class="tg">
  <tr>
    <th class="tg-yw4l">Name</th>
    <th class="tg-yw4l">Time in s</th>
  </tr>
  <tr>
    <td class="tg-yw4l">ifort -O3</td>
    <td class="tg-yw4l">1.46924</td>
  </tr>
  <tr>
    <td class="tg-yw4l">ipython</td>
    <td class="tg-yw4l">93.22092</td>
  </tr>
  <tr>
    <td class="tg-yw4l">julia 0.5</td>
    <td class="tg-yw4l">4.6647</td>
  </tr>
  <tr>
    <td class="tg-yw4l">gfortran -O3</td>
    <td class="tg-yw4l">1.3141262</td>
  </tr>
</table>

<p>These results are actually quite interesting to me. First of all they confirm what most benchmarks say: Julia is fast, but not as fast as a highly optimized compiled language like Fortran. The more suprising part to me was that gfortran actually beat ifort. I see this very rarely. This seems to be specific to this limited case.</p>

<p>This result is somewhat on the edge to me. Julia is suprisingly fast compared to an interpreted language, but on the other hand Fortran beats Julia by at lot. However, this is more or less my first Julia program, which is not the case for Fortran. I will have to look into writing optimized Julia code a bit more. The next question is going to be about the parallelism:</p>

<p>How does Julias parallelism fair against Fortrans OpenMP?</p>

  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
